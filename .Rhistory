group_by(Country) %>%
summarise(Food, total = sum(intake), percentage=(round(intake/total,4))*100) %>%
ggplot(aes(fill=Food, y=percentage, x=Country)) +
geom_bar(position="stack", stat="identity") +
labs(x="Country", title="Dietary Sturcture in 2018") +
coord_flip()
ggplotly(d_stru_18) %>% layout(xaxis = list(title = "Percentage in Diet"),
legend = list(orientation = "h",itemsizing="constant"))
#Changes of Dietary Structure in rural China
area <- countries_10 %>% filter(age == 999 & urban != 999 &
edu == 999 & Country == "China" &
female == 999 & year != 2020) %>%
mutate(area= case_when(urban==1 ~ "Urban",
urban==0 ~ "Rural"))
area_China <- area %>%
group_by(year) %>%
summarise(Food, area, total = sum(intake), percentage=(round(intake/total,4))*100, .groups = 'drop')
ru.mid<-ggplot(area_China,aes(x=1,y=Food))+geom_text(aes(label=Food))+
geom_segment(aes(x=0.94,xend=0.96,yend=Food))+
geom_segment(aes(x=1.04,xend=1.065,yend=Food))+
ggtitle("")+
ylab(NULL)+
scale_x_continuous(expand=c(0,0),limits=c(0.94,1.065))+
theme(axis.title=element_blank(),
panel.grid=element_blank(),
axis.text.y=element_blank(),
axis.ticks.y=element_blank(),
panel.background=element_blank(),
axis.text.x=element_text(color=NA),
axis.ticks.x=element_line(color=NA),
plot.margin = unit(c(1,-1,1,-1), "mm"))
ru_90 <- area_China %>%
filter(area=="Rural" & year==1990) %>%
ggplot(aes(x = Food, y = percentage,fill = Food)) +
geom_bar(stat = "identity") + ggtitle("Dietary Structure(Rural China,1990)") +
geom_text(aes(y=10, label = percentage),color = "black") +
coord_flip() + scale_y_reverse() +
theme(axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
legend.position="none",
panel.background=element_blank(),
plot.title = element_text(size = 10),
plot.margin = unit(c(1,-1,1,0), "mm"))
ru_18 <- area_China %>%
filter(area=="Rural" & year==2018) %>%
ggplot(aes(x = Food, y = percentage, fill = Food)) +
geom_bar(stat = "identity") + ggtitle("Dietary Structure(Rural China,2018)") +
geom_text(aes(y=10, label = percentage),color = "black") +
coord_flip() + xlab(NULL) +
theme(axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
legend.position="none",
panel.background=element_blank(),
plot.title = element_text(size = 10),
plot.margin = unit(c(1,-1,1,0), "mm"))
ru1 <- ggplot_gtable(ggplot_build(ru_90))
ru2 <- ggplot_gtable(ggplot_build(ru_18))
ru.mid <- ggplot_gtable(ggplot_build(ru.mid))
grid.arrange(ru1,ru.mid,ru2,ncol=3,widths=c(3/9,3/9,3/9))
#Changes of Dietary Structure 2018 in urban China
ur_90 <- area_China %>%
filter(area=="Urban" & year==1990) %>%
ggplot(aes(x = Food, y = percentage,fill = Food)) +
geom_bar(stat = "identity") + ggtitle("Dietary Structure(Urban China,1990)") +
geom_text(aes(y=10, label = percentage),color = "black") +
coord_flip() + scale_y_reverse() +
theme(axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
legend.position="none",
panel.background=element_blank(),
plot.title = element_text(size = 10),
plot.margin = unit(c(1,-1,1,0), "mm"))
ur_18 <- area_China %>%
filter(area=="Urban" & year==2018) %>%
ggplot(aes(x = Food, y = percentage, fill = Food)) +
geom_bar(stat = "identity") + ggtitle("Dietary Structure(Urban China,2018)") +
geom_text(aes(y=10, label = percentage),color = "black") +
coord_flip() + xlab(NULL) +
theme(axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
legend.position="none",
panel.background=element_blank(),
plot.title = element_text(size = 10),
plot.margin = unit(c(1,-1,1,0), "mm"))
library(gridExtra)
ur1 <- ggplot_gtable(ggplot_build(ur_90))
ur2 <- ggplot_gtable(ggplot_build(ur_18))
grid.arrange(ur1,ru.mid,ur2,ncol=3,widths=c(3/9,3/9,3/9))
# Changes of Refined Grains by Gender in China
gender <- countries_10 %>%
filter(age == 999 & urban == 999 & edu == 999 & Country == "China" &
female != 999 & year != 2020) %>%
mutate(gender= case_when(female==1 ~ "Female",
female==0 ~ "Male"))
gender_China <- gender %>%
group_by(year) %>%
summarise(Food, gender, total = sum(intake), percentage=(round(intake/total,4))*100)
rg_gender <- gender_China %>%
filter(types == "Refined grains") %>%
ggplot(aes(x = year, y=percentage, group=gender, color=gender)) +
geom_line( size=1) +
geom_point(size=1) +
labs(x="Year", y="Percentage of Refined Grains", title="Refined Grains in Dietary Structure by Gender in China") +
theme_classic()
rg_gender <- gender_China %>%
filter(Food == "Refined grains") %>%
ggplot(aes(x = year, y=percentage, group=gender, color=gender)) +
geom_line( size=1) +
geom_point(size=1) +
labs(x="Year", y="Percentage of Refined Grains", title="Refined Grains in Dietary Structure by Gender in China") +
theme_classic()
ggplotly(rg_gender)
#Changes of Non-starchy Vegetables by Gender in China
nv_gender <- gender_China %>%
filter(Food == "Non-starchy vegetables") %>%
ggplot(aes(x = year, y=percentage, group=gender, color=gender)) +
geom_line( size=1) +
geom_point(size=1) +
labs(x="Year", y="Percentage of Non-starchy vegetables", title="Non-starchy vegetables in Dietary Structure by Gender in China") +
theme_classic()
ggplotly(nv_gender)
# Changes of Refined Grains by Gender in China
gender <- countries_10 %>%
filter(age == 999 & urban == 999 & edu == 999 & Country == "China" &
female != 999 & year != 2020) %>%
mutate(gender= case_when(female==1 ~ "Female",
female==0 ~ "Male"))
gender_China <- gender %>%
group_by(year) %>%
summarise(Food, gender, total = sum(intake), percentage=(round(intake/total,4))*100)
rg_gender <- gender_China %>%
filter(Food == "Refined grains") %>%
ggplot(aes(x = year, y=percentage, group=gender, color=c("#ef8a62","#2166ac"))) +
geom_line( size=1) +
geom_point(size=1) +
labs(x="Year", y="Percentage of Refined Grains", title="Refined Grains in Dietary Structure by Gender in China") +
theme_classic()
ggplotly(rg_gender)
# Changes of Refined Grains by Gender in China
gender <- countries_10 %>%
filter(age == 999 & urban == 999 & edu == 999 & Country == "China" &
female != 999 & year != 2020) %>%
mutate(gender= case_when(female==1 ~ "Female",
female==0 ~ "Male"))
gender_China <- gender %>%
group_by(year) %>%
summarise(Food, gender, total = sum(intake), percentage=(round(intake/total,4))*100)
rg_gender <- gender_China %>%
filter(Food == "Refined grains") %>%
ggplot(aes(x = year, y=percentage, group=gender, color=gender)) +
geom_line( size=1) +
geom_point(size=1) +
labs(x="Year", y="Percentage of Refined Grains", title="Refined Grains in Dietary Structure by Gender in China") +
scale_color_manual(values = c("#ef8a62","#2166ac"))
theme_classic()
ggplotly(rg_gender)
# Changes of Refined Grains by Gender in China
gender <- countries_10 %>%
filter(age == 999 & urban == 999 & edu == 999 & Country == "China" &
female != 999 & year != 2020) %>%
mutate(gender= case_when(female==1 ~ "Female",
female==0 ~ "Male"))
gender_China <- gender %>%
group_by(year) %>%
summarise(Food, gender, total = sum(intake), percentage=(round(intake/total,4))*100)
rg_gender <- gender_China %>%
filter(Food == "Refined grains") %>%
ggplot(aes(x = year, y=percentage, group=gender, color=gender)) +
geom_line( size=1) +
geom_point(size=1) +
labs(x="Year", y="Percentage of Refined Grains", title="Refined Grains in Dietary Structure by Gender in China") +
scale_color_manual(values = c("#ef8a62","#2166ac")) +
theme_classic()
ggplotly(rg_gender)
#Changes of Non-starchy Vegetables by Gender in China
nv_gender <- gender_China %>%
filter(Food == "Non-starchy vegetables") %>%
ggplot(aes(x = year, y=percentage, group=gender, color=gender)) +
geom_line( size=1) +
geom_point(size=1) +
labs(x="Year", y="Percentage of Non-starchy vegetables", title="Non-starchy vegetables in Dietary Structure by Gender in China") +
scale_color_manual(values = c("#ef8a62","#2166ac")) +
theme_classic()
ggplotly(nv_gender)
# Changes of Refined Grains by Gender in China
gender <- countries_10 %>%
filter(age == 999 & urban == 999 & edu == 999 & Country == "China" &
female != 999 & year != 2020) %>%
mutate(gender= case_when(female==1 ~ "Female",
female==0 ~ "Male"))
gender_China <- gender %>%
group_by(year) %>%
summarise(Food, gender, total = sum(intake), percentage=(round(intake/total,4))*100)
rg_gender <- gender_China %>%
filter(Food == "Refined grains") %>%
ggplot(aes(x = year, y=percentage, group=gender, color=gender)) +
geom_line( size=1) +
geom_point(size=1) +
labs(x="Year", y="Percentage of Refined Grains", title="Refined Grains in Dietary Structure by Gender in China") +
theme_pander()
ggplotly(rg_gender)
# Changes of Refined Grains by Gender in China
gender <- countries_10 %>%
filter(age == 999 & urban == 999 & edu == 999 & Country == "China" &
female != 999 & year != 2020) %>%
mutate(gender= case_when(female==1 ~ "Female",
female==0 ~ "Male"))
gender_China <- gender %>%
group_by(year) %>%
summarise(Food, gender, total = sum(intake), percentage=(round(intake/total,4))*100)
rg_gender <- gender_China %>%
filter(Food == "Refined grains") %>%
ggplot(aes(x = year, y=percentage, group=gender, color=gender)) +
geom_line( size=1) +
geom_point(size=1) +
labs(x="Year", y="Percentage of Refined Grains", title="Refined Grains in Dietary Structure by Gender in China") +
#scale_color_manual(values = c("#ef8a62","#2166ac")) +
theme_classic()
ggplotly(rg_gender)
# Changes of Refined Grains by Gender in China
gender <- countries_10 %>%
filter(age == 999 & urban == 999 & edu == 999 & Country == "China" &
female != 999 & year != 2020) %>%
mutate(gender= case_when(female==1 ~ "Female",
female==0 ~ "Male"))
gender_China <- gender %>%
group_by(year) %>%
summarise(Food, gender, total = sum(intake), percentage=(round(intake/total,4))*100)
rg_gender <- gender_China %>%
filter(Food == "Refined grains") %>%
ggplot(aes(x = year, y=percentage, group=gender, color=gender)) +
geom_line( size=1) +
geom_point(size=1) +
labs(x="Year", y="Percentage of Refined Grains", title="Refined Grains in Dietary Structure by Gender in China") +
scale_color_manual(values = c("#ef8a62","#2166ac")) +
theme_classic()
ggplotly(rg_gender)
# Changes of Refined Grains by Gender in China
gender <- countries_10 %>%
filter(age == 999 & urban == 999 & edu == 999 & Country == "China" &
female != 999 & year != 2020) %>%
mutate(gender= case_when(female==1 ~ "Female",
female==0 ~ "Male"))
gender_China <- gender %>%
group_by(year) %>%
summarise(Food, gender, total = sum(intake), percentage=(round(intake/total,4))*100)
rg_gender <- gender_China %>%
filter(Food == "Refined grains") %>%
ggplot(aes(x = year, y=percentage, group=gender, color=gender)) +
geom_line( size=1) +
geom_point(size=1) +
labs(x="Year", y="Percentage of Refined Grains", title="Refined Grains in Dietary Structure by Gender in China") +
theme_classic()
ggplotly(rg_gender)
#Changes of Non-starchy Vegetables by Gender in China
nv_gender <- gender_China %>%
filter(Food == "Non-starchy vegetables") %>%
ggplot(aes(x = year, y=percentage, group=gender, color=gender)) +
geom_line( size=1) +
geom_point(size=1) +
labs(x="Year", y="Percentage of Non-starchy vegetables", title="Non-starchy vegetables in Dietary Structure by Gender in China") +
theme_classic()
ggplotly(nv_gender)
knitr::opts_chunk$set(echo = TRUE)
# Load packages.
packages <- c("readr","ggplot2","tidyverse","dplyr","data.table","fs","plotly",
'glue','maps','ggpubr','ggmap','ggthemes','leaflet','tidytext',
'textdata','DT','grid','gridExtra','rio','textstem','tm','wordcloud2','qdapRegex')
packages <- lapply(packages, FUN = function(x) {
if(!require(x, character.only = TRUE)) {
install.packages(x)
library(x, character.only = TRUE)
}
}
)
# READ FILES
# selected countries (include China, Germany, Japan, North Korea, Pakistan, Palestine, Sudan, Syria, United States, India)
country_list = c('CHN','DEU','IND','JPN','PRK','PAK','PSE','SDN','SYR','USA')
# read the file with country code, country name, and life expectancy
life_df <- read_csv('data/life_exp.csv',show_col_types = FALSE) %>%
mutate(year = as.numeric(year))
knitr::opts_chunk$set(echo = TRUE)
# Load packages.
packages <- c("readr","ggplot2","tidyverse","dplyr","data.table","fs","plotly",
'glue','maps','ggpubr','ggmap','ggthemes','leaflet','tidytext',
'textdata','DT','grid','gridExtra','rio','textstem','tm','wordcloud2','qdapRegex')
packages <- lapply(packages, FUN = function(x) {
if(!require(x, character.only = TRUE)) {
install.packages(x)
library(x, character.only = TRUE)
}
}
)
# READ FILES
# selected countries (include China, Germany, Japan, North Korea, Pakistan, Palestine, Sudan, Syria, United States, India)
country_list = c('CHN','DEU','IND','JPN','PRK','PAK','PSE','SDN','SYR','USA')
# read the file with country code, country name, and life expectancy
life_df <- read_csv('data/life_exp.csv',show_col_types = FALSE) %>%
mutate(year = as.numeric(year))
# read the file with food intake
food_df <- read_csv('data/Country-level Nutritions.csv',show_col_types = FALSE)%>%
filter(varnum <15)%>%
rename(intake=median)
# read the file with food code, and food name
food_code <- read_csv('data/food_code.csv',show_col_types = FALSE)
# read the file with food code, and food name
country_code <- read_csv('data/country_code.csv',show_col_types = FALSE)
# left join the two files above
food_life <- food_df %>%
left_join(x=food_df, y=life_df, by = c('iso3'='Code','year'='year'))  %>%
left_join(.,y=food_code, by = c('varnum'='varnum'))
#a wordcloud with "nutritional" tag in twitter
n <- "data/nutritional"
files <- list.files(n, pattern="csv", full.names=TRUE) %>%
set_names()
wc_n <- files %>% map_dfr(read_csv, .id="filename")
n_text <- str_c(wc_n$data.text, collapse = "")
#clean the text
n_text <-
n_text %>%
str_remove("\\n") %>%                   # remove linebreaks
rm_twitter_url() %>%                    # Remove URLS
rm_url() %>%
str_remove_all("#\\S+") %>%             # Remove any hashtags
str_remove_all("@\\S+") %>%             # Remove any @ mentions
removeWords(stopwords("english")) %>%   # Remove common words (a, the, it etc.)
removeNumbers() %>%
stripWhitespace() %>%
removeWords(c("amp")) %>%
removeWords(stopwords("SMART")) %>%
removePunctuation()
removeNumPunct <- function(x){gsub("[^[:alpha:][:space:]]*", "", x)}
# Convert the data into a summary table
n_Corpus <-
Corpus(VectorSource(n_text)) %>%
tm_map(content_transformer(removeNumPunct)) %>%
TermDocumentMatrix() %>%
as.matrix()
n_Corpus <- sort(rowSums(n_Corpus), decreasing=TRUE)
n_Corpus <- data.frame(word = names(n_Corpus), freq=n_Corpus, row.names = NULL)
#wordcloud
set.seed(1000)
wordcloud2(n_Corpus, color = 'random-light', size = 2, minRotation = -pi/6, maxRotation = -pi/6)
top_food_box <- food_life %>%
filter(year==2018,age==999,female==999,urban==999,edu==999) %>%
ggplot(.,aes(x=reorder(Food,intake), y=intake))+
geom_boxplot( aes(color=Food,group=Food,fill=Food),alpha = 0.7)+
labs(title="Food Intake Worldwide",
caption= "Source:Global Dietary Database",
y="Average Food Daily Intake(g/d)",x='')+
# theme(legend.position='none')+
theme_pander()+
coord_flip()
ggplotly(top_food_box)
top_food_sex <- food_life %>%
filter(year==2018,age==999,female!=999,urban==999,edu==999) %>%
mutate(sex=if_else(female==1,'female','male'))%>%
group_by(Food,sex)%>%
summarise(intake_avg = round(mean(intake),2))%>%
arrange(desc(intake_avg))
ggplot(top_food_sex,aes(x=reorder(Food,intake_avg), y=intake_avg,fill=sex)) +
geom_bar(stat="identity",position="dodge", width = 0.5, alpha = 0.7) +
labs(title="Differences in Food Intake for Female & Male",
caption= "Source:Global Dietary Database",
y="Average Food Daily Intake",x='')+
theme_pander()+
coord_flip()
# Average Food Intake Worldwide by Year
top_year <- food_life %>%
filter(age==999,female==999,urban==999,edu==999) %>%
group_by(year,Food)%>%
summarise(intake_avg = round(mean(intake),2))%>%
arrange(desc(intake_avg))
plot1 <- top_year%>%
ggplot(., aes(x = year, y=intake_avg,group=Food,color=Food)) +
geom_line( size=1)+
geom_point(size=1)+
labs(x='Year', y='Intake Avg(g/day)', title='Average Food Intake Worldwide')+
theme_classic()
ggplotly(plot1)
#Dietary Structure of 10 countries in 1990
# select food intake data in 10 countries
countries_10 <- filter(food_life, iso3 %in% country_list)
#select the general data points (all demographics features = 999)
gen_countries <- countries_10 %>% filter(age == 999 &
female == 999,
urban == 999,
edu == 999)
#Dietary Structure 1990
d_stru_90 <- gen_countries %>% filter(year==1990) %>%
group_by(Country) %>%
summarise(Food, total = sum(intake), percentage=(round(intake/total,4))*100) %>%
ggplot(aes(fill=Food, y=percentage, x=Country)) +
geom_bar(position="stack", stat="identity") +
labs(x="Country", title="Dietary Sturcture in 1990") +
coord_flip()
ggplotly(d_stru_90) %>% layout(xaxis = list(title = "Percentage in Diet"),
legend = list(orientation = "h",itemsizing="constant"))
#Dietary Structure of 10 countries in 1990
# select food intake data in 10 countries
countries_10 <- filter(food_life, iso3 %in% country_list)
#select the general data points (all demographics features = 999)
gen_countries <- countries_10 %>% filter(age == 999 &
female == 999,
urban == 999,
edu == 999)
#Dietary Structure 1990
d_stru_90 <- gen_countries %>% filter(year==1990) %>%
group_by(Country) %>%
summarise(Food, total = sum(intake), percentage=(round(intake/total,4))*100) %>%
ggplot(aes(fill=Food, y=percentage, x=Country)) +
geom_bar(position="stack", stat="identity") +
labs(x="Country", title="Dietary Sturcture in 1990") +
theme_classic() +
coord_flip()
ggplotly(d_stru_90) %>% layout(xaxis = list(title = "Percentage in Diet"),
legend = list(orientation = "h",itemsizing="constant"))
#Dietary Structure of 10 countries in 1990
# select food intake data in 10 countries
countries_10 <- filter(food_life, iso3 %in% country_list)
#select the general data points (all demographics features = 999)
gen_countries <- countries_10 %>% filter(age == 999 &
female == 999,
urban == 999,
edu == 999)
#Dietary Structure 1990
d_stru_90 <- gen_countries %>% filter(year==1990) %>%
group_by(Country) %>%
summarise(Food, total = sum(intake), percentage=(round(intake/total,4))*100) %>%
ggplot(aes(fill=Food, y=percentage, x=Country)) +
geom_bar(position="stack", stat="identity") +
labs(x="Country", title="Dietary Sturcture in 1990") +
theme_pander() +
coord_flip()
ggplotly(d_stru_90) %>% layout(xaxis = list(title = "Percentage in Diet"),
legend = list(orientation = "h",itemsizing="constant"))
#Dietary Structure of 10 countries in 1990
# select food intake data in 10 countries
countries_10 <- filter(food_life, iso3 %in% country_list)
#select the general data points (all demographics features = 999)
gen_countries <- countries_10 %>% filter(age == 999 &
female == 999,
urban == 999,
edu == 999)
#Dietary Structure 1990
d_stru_90 <- gen_countries %>% filter(year==1990) %>%
group_by(Country) %>%
summarise(Food, total = sum(intake), percentage=(round(intake/total,4))*100) %>%
ggplot(aes(fill=Food, y=percentage, x=Country)) +
geom_bar(position="stack", stat="identity") +
labs(x="Country", title="Dietary Sturcture in 1990") +
theme_classic() +
coord_flip()
ggplotly(d_stru_90) %>% layout(xaxis = list(title = "Percentage in Diet"),
legend = list(orientation = "h",itemsizing="constant"))
#Dietary Structure of 10 countries in 1990
# select food intake data in 10 countries
countries_10 <- filter(food_life, iso3 %in% country_list)
#select the general data points (all demographics features = 999)
gen_countries <- countries_10 %>% filter(age == 999 &
female == 999,
urban == 999,
edu == 999)
#Dietary Structure 1990
d_stru_90 <- gen_countries %>% filter(year==1990) %>%
group_by(Country) %>%
summarise(Food, total = sum(intake), percentage=(round(intake/total,4))*100) %>%
ggplot(aes(fill=Food, y=percentage, x=Country)) +
geom_bar(position="stack", stat="identity") +
labs(x="Country", title="Dietary Sturcture in 1990") +
scale_colour_brewer(palette = "Set3") +
coord_flip()
ggplotly(d_stru_90) %>% layout(xaxis = list(title = "Percentage in Diet"),
legend = list(orientation = "h",itemsizing="constant"))
#Dietary Structure of 10 countries in 1990
# select food intake data in 10 countries
countries_10 <- filter(food_life, iso3 %in% country_list)
#select the general data points (all demographics features = 999)
gen_countries <- countries_10 %>% filter(age == 999 &
female == 999,
urban == 999,
edu == 999)
#Dietary Structure 1990
d_stru_90 <- gen_countries %>% filter(year==1990) %>%
group_by(Country) %>%
summarise(Food, total = sum(intake), percentage=(round(intake/total,4))*100) %>%
ggplot(aes(fill=Food, y=percentage, x=Country)) +
geom_bar(position="stack", stat="identity") +
labs(x="Country", title="Dietary Sturcture in 1990") +
theme_classic() +
coord_flip()
ggplotly(d_stru_90) %>% layout(xaxis = list(title = "Percentage in Diet"),
legend = list(orientation = "h",itemsizing="constant"))
#Dietary Structure of 10 countries in 2018
d_stru_18 <- gen_countries %>% filter(year==2018) %>%
group_by(Country) %>%
summarise(Food, total = sum(intake), percentage=(round(intake/total,4))*100) %>%
ggplot(aes(fill=Food, y=percentage, x=Country)) +
geom_bar(position="stack", stat="identity") +
labs(x="Country", title="Dietary Sturcture in 2018") +
theme_classic() +
coord_flip()
ggplotly(d_stru_18) %>% layout(xaxis = list(title = "Percentage in Diet"),
legend = list(orientation = "h",itemsizing="constant"))
